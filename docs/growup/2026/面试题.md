# 2026年面试题


## 1. 国际汇款延迟处理

设计一个多币种汇款系统，若中间行处理超时，如何实现自动冲正（ReverseTransaction）？

答案：（AI）
1. 系统设计：
   - 引入事件驱动架构，使用消息队列（如Kafka、RabbitMQ）处理异步事件。
   - 定义事件：`TransactionCreated`、`TransactionProcessed`、`TransactionFailed`。
2. 超时处理：
   - 当中间行处理超时时，触发`TransactionFailed`事件。
   - 事件处理程序检查是否存在未处理的`TransactionFailed`事件。
   - 如果存在，触发`ReverseTransaction`事件。
3. 冲正处理：
   - 当触发`ReverseTransaction`事件时，调用中间行API执行冲正操作。
   - 若冲正成功，触发`TransactionProcessed`事件。
   - 若冲正失败，根据业务规则（如重试次数）触发`TransactionFailed`事件。

## 2. 重复支付防止

用户因网络延迟重复提交付款请求，如何通过分布式锁（Redis/Zookeeper）和数据库唯一索引保证幂等性？

答案：（AI）
1. 分布式锁：
   - 客户端在提交付款请求前，尝试获取分布式锁（如Redis的`SETNX`命令或Zookeeper的`CREATE`命令）。
   - 如果获取成功，继续处理请求；如果获取失败，说明有其他客户端在处理中，直接返回失败。
2. 数据库唯一索引：
   - 在数据库中为付款请求表添加一个唯一索引，例如基于`transaction_id`字段。
   - 当客户端提交付款请求时，尝试插入数据库记录。
   - 如果插入成功，说明是第一次请求，继续处理；如果插入失败（如唯一索引冲突），说明是重复请求，直接返回失败。

## 3. 批量代发工资优化

企业客户上传10万笔工资代发文件，如何用SpringBatch分片处理，并在处理失败时提供部分回滚机制？

答案：（AI）
1. 分片处理：
   - 使用SpringBatch的分片功能，将10万笔记录分成多个分片（如1000条记录为一个分片）。
   - 每个分片独立处理，互不干扰。
2. 失败回滚：
   - 配置SpringBatch的`JobExecutionListener`，在处理失败时触发回滚。
   - 回滚机制可以是回滚当前分片的处理，也可以是回滚整个Job的处理。
   - 可以根据业务需求，选择合适的回滚策略。

## 4. 账户余额并发更新

高并发场景下（如秒杀活动），如何避免账户余额扣减的竞态条件？

答案：（AI）
1. 数据库事务：
   - 在每次账户余额扣减操作前，开启一个数据库事务。
   - 在事务中执行查询操作，检查账户余额是否充足。
   - 如果充足，执行扣减操作；如果不足，回滚事务。
2. 乐观锁：
   - 在账户表中添加一个版本号字段（如`version`）。
   - 在每次账户余额扣减操作前，查询账户记录并获取当前版本号。
   - 在执行扣减操作时，将版本号作为条件，只有当版本号未被修改时才执行更新操作。
   - 如果更新失败（如版本号已被修改），说明有其他并发操作修改了账户余额，需要重新尝试。

对比悲观锁（SELECTFORUPDATE）和乐观锁（版本号）的实现？

1. 悲观锁：
   - 悲观锁假设会发生并发冲突，因此在操作数据前直接对数据加锁。
   - 例如，在MySQL中使用`SELECTFORUPDATE`语句对查询结果加行级锁。
   - 悲观锁适用于并发冲突比较严重的场景，能够确保数据的一致性。
2. 乐观锁：
   - 乐观锁假设不会发生并发冲突，因此在操作数据时不直接加锁，而是在更新数据时检查版本号是否被修改。
   - 乐观锁适用于并发冲突比较少的场景，能够提高系统的吞吐量。

## 5. 分布式事务与一致性

在银行跨行转账场景下，如何确保分布式事务的一致性？

答案：（AI）
1. 两阶段提交（2PC）：
   - 协调者（Coordinator）协调多个参与者（Participants）的事务。
   - 第一阶段（Prepare Phase）：协调者向所有参与者发送准备消息，询问是否可以提交事务。
   - 第二阶段（Commit Phase）：如果所有参与者都回复可以提交，协调者向所有参与者发送提交消息；否则，发送回滚消息。
2. 补偿事务（SAGA模式）：
   - 将分布式事务拆分成多个本地事务，每个本地事务都有一个补偿操作。
   - 如果某个本地事务失败，系统会执行其对应的补偿操作，回滚之前的操作。


## 6. 日终批处理对账

设计一个日终对账系统，对比核心银行系统与第三方支付渠道的交易流水，输出差异报告。如何用多线程加速千万级数据比对？




## 7. 历史账户查询性能

客户查询5年前交易记录时响应缓慢，请设计分表分库（按时间范围）和冷热数据分离方案（如ES归档），优化查询性能。

## 8. 死信队列监控

设计一个死信队列（DLO）告警机制，当支付消息处理失败超过3次时触发人工干预。

## 9. 敏感数据加密

客户姓名、证件号在数据库中如何加密？

## 10.

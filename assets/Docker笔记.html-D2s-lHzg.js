import{_ as n,c as a,a as e,o as l}from"./app-iMoEB5u2.js";const p={};function i(t,s){return l(),a("div",null,s[0]||(s[0]=[e(`<h1 id="应用容器-docker" tabindex="-1"><a class="header-anchor" href="#应用容器-docker"><span>应用容器：Docker</span></a></h1><h2 id="faq" tabindex="-1"><a class="header-anchor" href="#faq"><span>FAQ</span></a></h2><p><strong>如何查看宿主机IP？</strong></p><ul><li>Linux：在命令行输入“ifconfig”命令。里面docker0对应的就是宿主机ip。</li><li>Windows（Docker Desktop）：</li></ul><h2 id="docker入门" tabindex="-1"><a class="header-anchor" href="#docker入门"><span>Docker入门</span></a></h2><h4 id="为什么需要容器化" tabindex="-1"><a class="header-anchor" href="#为什么需要容器化"><span>为什么需要容器化？</span></a></h4><p>略。</p><h4 id="基本概念" tabindex="-1"><a class="header-anchor" href="#基本概念"><span>基本概念</span></a></h4><p><em><strong>【镜像（Image）】</strong></em> 一个镜像将配置好的操作系统、基本的运行环境打成一个包。这样部署时只要用打好包的镜像来创建一个虚拟操作系统（即Docker容器）即可。 <em><strong>镜像</strong></em> 可理解为一个“安装包”，运维人员运行 <em><strong>镜像</strong></em> 后，就会生成一个 <em><strong>Docker容器</strong></em> 在本机，容器里包含了已配置好的 <em><strong>环境（例如JDK、Python）</strong></em> 、<em><strong>环境变量（JAVA_HOME）</strong></em> 以及 <em><strong>应用程序</strong></em> ，无需运维人员再配置。</p><p><em><strong>【镜像仓库（Docker Registry）】</strong></em> 用来存放镜像文件。</p><p><em><strong>【Docker容器（Container）】</strong></em> 即一个系统运行实例（类似虚拟系统）。</p><p><em><strong>【Docker engine】</strong></em> 当人们说“Docker”时，指的就是docker engine。docker engine由以下3部分组成：</p><ol><li>Docker守护进程（内核）</li><li>与守护进程交互的REST API（系统函数）</li><li>在REST API下封装的命令行接口（CLI）</li></ol><h4 id="docker与vm-虚拟操作系统-的区别" tabindex="-1"><a class="header-anchor" href="#docker与vm-虚拟操作系统-的区别"><span>Docker与VM（虚拟操作系统）的区别</span></a></h4><p>VM一旦分配便占用固定的资源（硬盘空间、内存空间）； Docker是一个应用，当需要创建一个Docker容器时，才分配资源，比较灵活。</p><h4 id="如何在linux上安装docker" tabindex="-1"><a class="header-anchor" href="#如何在linux上安装docker"><span>如何在Linux上安装Docker</span></a></h4><p>使用官方脚本进行安装。</p><p>安装命令如下：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://get.docker.com <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> <span class="token function">docker</span> <span class="token parameter variable">--mirror</span> Aliyun</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>也可以使用国内 daocloud 一键安装命令：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-sSL</span> https://get.daocloud.io/docker <span class="token operator">|</span> <span class="token function">sh</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="如何在windows上安装docker" tabindex="-1"><a class="header-anchor" href="#如何在windows上安装docker"><span>如何在Windows上安装Docker</span></a></h4><p>https://www.cnblogs.com/wusha/p/8556567.html</p><h4 id="启动docker" tabindex="-1"><a class="header-anchor" href="#启动docker"><span>启动Docker</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">systemctl start docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="启动docker的容器" tabindex="-1"><a class="header-anchor" href="#启动docker的容器"><span>启动Docker的容器</span></a></h4><p>见Docker常见操作/容器操作</p><h2 id="docker进阶" tabindex="-1"><a class="header-anchor" href="#docker进阶"><span>Docker进阶</span></a></h2><h4 id="docker仓库" tabindex="-1"><a class="header-anchor" href="#docker仓库"><span>Docker仓库</span></a></h4><h5 id="搭建私有仓库" tabindex="-1"><a class="header-anchor" href="#搭建私有仓库"><span>搭建私有仓库</span></a></h5><ol><li><p>下载 https://github.com/goharbor/harbor/releases</p></li><li><p>解压</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xvf</span> harbor-offline-installer-v1.2.2.tgz</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li>修改 harbor.cfg</li></ol><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties"><pre><code class="language-properties"><span class="line"><span class="token comment">#hostname 改为本地ip，非 Mac OS系统 可以不指定端口</span></span>
<span class="line"><span class="token key attr-name">hostname</span> <span class="token punctuation">=</span> <span class="token value attr-value">192.168.31.143:9090</span></span>
<span class="line"><span class="token comment">#设置secretkey_path 的路径为 当前目录的data下</span></span>
<span class="line"><span class="token key attr-name">secretkey_path</span> <span class="token punctuation">=</span> <span class="token value attr-value">./data</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>启动 harbor</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">./install.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="5"><li>访问 http://127.0.0.1:9090/ 默认 admin 用户的密码为 Harbor12345 ，可以在 harbor.cfg 进行修改。</li></ol><p><strong>Docker客户端的操作</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment">#登录私服仓库</span></span>
<span class="line"><span class="token function">docker</span> login <span class="token parameter variable">-u</span> admin <span class="token parameter variable">-p</span> Harbor12345 <span class="token number">127.0</span>.0.1:9090</span>
<span class="line"></span>
<span class="line"><span class="token comment">#将某个镜像标志为需要推送到哪个仓库</span></span>
<span class="line"><span class="token function">docker</span> tag nginx:latest <span class="token number">127.0</span>.0.1:9090/library/nginx:latest</span>
<span class="line"></span>
<span class="line"><span class="token comment">#推送到私服仓库</span></span>
<span class="line"><span class="token function">docker</span> push <span class="token number">127.0</span>.0.1:9090/library/nginx:latest</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="镜像生成脚本-dockerfile" tabindex="-1"><a class="header-anchor" href="#镜像生成脚本-dockerfile"><span>镜像生成脚本：Dockerfile</span></a></h4><h5 id="dockerfile是干什么的" tabindex="-1"><a class="header-anchor" href="#dockerfile是干什么的"><span>Dockerfile是干什么的？</span></a></h5><p>实质就是一个制作Docker镜像的一段脚本。</p><h5 id="怎么制作" tabindex="-1"><a class="header-anchor" href="#怎么制作"><span>怎么制作？</span></a></h5><ol><li>创建一个文件夹（mkdir samp1）</li><li>在该文件夹下新建一个Dockerfile文件（cd ./samp1 ; touch Dockerfile）</li><li>编写脚本</li><li>在Dockerfile脚本的目录下执行：docker build -t [镜像标签名] . 或者执行docker build -f ./samp/Dockerfile -t [镜像标签名] .</li><li>执行docker image ls，查看是否已生成镜像</li></ol><h5 id="dockerfile语法" tabindex="-1"><a class="header-anchor" href="#dockerfile语法"><span>Dockerfile语法</span></a></h5><h6 id="dockerfile示例" tabindex="-1"><a class="header-anchor" href="#dockerfile示例"><span>Dockerfile示例</span></a></h6><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment"># samp1/Dockerfile</span></span>
<span class="line"><span class="token comment"># 创建一个linux容器，创建人为dyz</span></span>
<span class="line"><span class="token comment"># 执行构建命令：docker build -t samp1:v1 .</span></span>
<span class="line"><span class="token comment"># 执行启动命令：docker run samp1后打印出hello world</span></span>
<span class="line">FROM centos<span class="token punctuation">:</span>latest</span>
<span class="line">MAINTAINER dyz</span>
<span class="line">CMD echo <span class="token string">&quot;hello world&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token comment"># samp2/Dockerfile</span></span>
<span class="line">FROM centos<span class="token punctuation">:</span>latest</span>
<span class="line">MAINTAINER dyz</span>
<span class="line">ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;echo&quot;</span><span class="token punctuation">]</span></span>
<span class="line">CMD <span class="token punctuation">[</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="每条指令的用法及作用" tabindex="-1"><a class="header-anchor" href="#每条指令的用法及作用"><span>每条指令的用法及作用</span></a></h6><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code class="language-python"><span class="line"><span class="token keyword">from</span> <span class="token operator">&lt;</span>继承于哪个dockerfile<span class="token operator">&gt;</span> <span class="token comment">#</span></span>
<span class="line">maintainer <span class="token operator">&lt;</span>创建人<span class="token operator">&gt;</span> <span class="token comment">#创建人</span></span>
<span class="line">copy <span class="token operator">&lt;</span>源路径<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>目标路径<span class="token operator">&gt;</span> <span class="token comment">#生成容器后，将源路径中的文件拷贝到容器的目标路径中</span></span>
<span class="line">add <span class="token operator">&lt;</span>源路径<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>目标路径<span class="token operator">&gt;</span> <span class="token comment">#与COPY类似，但在拷贝tar文件时还会自动解压</span></span>
<span class="line">entrypoint </span>
<span class="line"><span class="token comment"># 容器启动时默认启动的运行程序</span></span>
<span class="line"><span class="token comment"># 多条CMD命令下，仅最后一条命令生效</span></span>
<span class="line"><span class="token comment"># 会被docker run 后面的指令及参数覆盖</span></span>
<span class="line"><span class="token comment"># docker run时，加上--entrypoint，可以覆盖entrypoint定义的内容</span></span>
<span class="line"><span class="token comment"># 格式：</span></span>
<span class="line"><span class="token comment">#  ENTRYPOINT [&quot;&lt;可执行文件或命令&gt;&quot;,&quot;&lt;param1&gt;&quot;,&quot;&lt;param2&gt;&quot;,...] （推荐）</span></span>
<span class="line">cmd <span class="token operator">&lt;</span>shell命令<span class="token operator">&gt;</span></span>
<span class="line"><span class="token comment"># 作用：</span></span>
<span class="line"><span class="token comment"># 1. 容器启动时默认启动的运行程序的默认参数</span></span>
<span class="line"><span class="token comment"># 2. 也可以与entrypoint一样，定义容器启动时的默认启动的运行程序</span></span>
<span class="line"><span class="token comment"># 多条CMD命令下，仅最后一条命令生效</span></span>
<span class="line"><span class="token comment"># 格式：</span></span>
<span class="line"><span class="token comment"># 1. CMD &lt;shell命令&gt;</span></span>
<span class="line"><span class="token comment"># 2. CMD [&quot;&lt;可执行文件或命令&gt;&quot;,&quot;&lt;param1&gt;&quot;,&quot;&lt;param2&gt;&quot;,...] （推荐）</span></span>
<span class="line"><span class="token comment"># 3. CMD [&quot;&lt;param1&gt;&quot;,&quot;&lt;param2&gt;&quot;,...]  # 该写法是为 ENTRYPOINT 指令指定的程序提供默认参数</span></span>
<span class="line">env <span class="token operator">&lt;</span>key<span class="token operator">&gt;=</span><span class="token operator">&lt;</span>value<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>key<span class="token operator">&gt;=</span><span class="token operator">&lt;</span>value<span class="token operator">&gt;</span> <span class="token comment">#设置环境变量</span></span>
<span class="line">arg <span class="token operator">&lt;</span>key<span class="token operator">&gt;=</span><span class="token operator">&lt;</span>value<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>key<span class="token operator">&gt;=</span><span class="token operator">&lt;</span>value<span class="token operator">&gt;</span> <span class="token comment">#定义参数，参数仅dockerfile内有效</span></span>
<span class="line">volume <span class="token punctuation">[</span><span class="token string">&quot;&lt;路径1&gt;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&lt;路径2&gt;&quot;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token comment">#定义匿名数据卷</span></span>
<span class="line">expose <span class="token operator">&lt;</span>端口号<span class="token number">1</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>端口号<span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">#开启容器端口</span></span>
<span class="line">workdir <span class="token string">&quot;工作目录&quot;</span> <span class="token comment">#设置当前工作目录</span></span>
<span class="line">user</span>
<span class="line">healthcheck</span>
<span class="line">onbuild</span>
<span class="line">label</span>
<span class="line">run <span class="token comment">#启动前跑的shell命令，例如：run yum -y install httpd（安装httpd）</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="多容器运行-docker-compose" tabindex="-1"><a class="header-anchor" href="#多容器运行-docker-compose"><span>多容器运行：Docker Compose</span></a></h4><p>解决“方便在一台主机上同时运行多个容器”的需求。</p><p>步骤： 0. 创建一个新目录（比如/myapp）</p><ol><li>编写Dockerfile（定义不同的应用程序）</li><li>编写docker-compose.yml（定义这些程序的运行环境，语法见“Docker常见命令-多容器操作”）</li><li>执行docker-compose up命令，启动多容器</li></ol><blockquote><p>启动后，会默认为这个多容器创建一个默认的网络。按照上面例子，则会创建一个名为“myapp_default”的网络。可通过docker network ls命令查看。</p></blockquote><p>检查是否已安装docker-compose</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker-compose</span> <span class="token parameter variable">--version</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>下载docker-compose当前的稳定版本</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token string">&quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>&quot;</span> <span class="token parameter variable">-o</span> /usr/local/bin/docker-compose</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>增加权限</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建软链</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/bin/docker-compose /usr/bin/docker-compose</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="集群部署-docker-swarm" tabindex="-1"><a class="header-anchor" href="#集群部署-docker-swarm"><span>集群部署：Docker Swarm</span></a></h4><p>解决“增加Docker服务器，对Docker服务进行扩容，并将其构建成一个Docker集群”的需求。</p><p>Raft协议：保证大多数节点存活，集群才可以使用。因此通过Docker Swarm构建集群至少需要3台主机。</p><h4 id="docker的网络" tabindex="-1"><a class="header-anchor" href="#docker的网络"><span>Docker的网络</span></a></h4><blockquote><p>以下网络部分的内容均以Linux系统为基础。</p></blockquote><h5 id="网络基础" tabindex="-1"><a class="header-anchor" href="#网络基础"><span>网络基础</span></a></h5><p>物理主机需要通过网卡，才能连接到局域网、互联网，与其他物理主机通信。 网卡一头连着自己，另一头连着不同的网络，通过IP地址唯一的标识自己，标识要连向的网段。 也就是说，不同网卡表示，该机器连着不同的网络。</p><blockquote><p>在linux系统里，通过 ifconfig 命令或者 ip addr命令, 可以查看Linux系统中有哪些网络设备。 一般会看到以下的网卡： lo：本地环回的地址 eth0：阿里云内网的地址（云主机会有该网卡） docker0：docker网络的地址</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">docker0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">409</span><span class="token operator"><span class="token file-descriptor important">9</span>&lt;</span>UP,BROADCAST,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span></span>
<span class="line">        inet <span class="token number">172.17</span>.0.1  netmask <span class="token number">255.255</span>.0.0  broadcast <span class="token number">172.17</span>.255.255</span>
<span class="line">        ether 02:42:5a:d4:cb:38  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span></span>
<span class="line">        RX packets <span class="token number">28061</span>  bytes <span class="token number">2235433</span> <span class="token punctuation">(</span><span class="token number">2.1</span> MiB<span class="token punctuation">)</span></span>
<span class="line">        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span></span>
<span class="line">        TX packets <span class="token number">40302</span>  bytes <span class="token number">144133154</span> <span class="token punctuation">(</span><span class="token number">137.4</span> MiB<span class="token punctuation">)</span></span>
<span class="line">        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></span>
<span class="line"></span>
<span class="line">eth0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span></span>
<span class="line">        inet <span class="token number">172.27</span>.14.140  netmask <span class="token number">255.255</span>.192.0  broadcast <span class="token number">172.27</span>.63.255</span>
<span class="line">        ether 00:16:3e:19:ad:e7  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span></span>
<span class="line">        RX packets <span class="token number">23587257</span>  bytes <span class="token number">6897074026</span> <span class="token punctuation">(</span><span class="token number">6.4</span> GiB<span class="token punctuation">)</span></span>
<span class="line">        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span></span>
<span class="line">        TX packets <span class="token number">17405737</span>  bytes <span class="token number">9079226758</span> <span class="token punctuation">(</span><span class="token number">8.4</span> GiB<span class="token punctuation">)</span></span>
<span class="line">        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></span>
<span class="line"></span>
<span class="line">lo: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class="token operator">&gt;</span>  mtu <span class="token number">65536</span></span>
<span class="line">        inet <span class="token number">127.0</span>.0.1  netmask <span class="token number">255.0</span>.0.0</span>
<span class="line">        loop  txqueuelen <span class="token number">1</span>  <span class="token punctuation">(</span>Local Loopback<span class="token punctuation">)</span></span>
<span class="line">        RX packets <span class="token number">8494147</span>  bytes <span class="token number">526641811</span> <span class="token punctuation">(</span><span class="token number">502.2</span> MiB<span class="token punctuation">)</span></span>
<span class="line">        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span></span>
<span class="line">        TX packets <span class="token number">8494147</span>  bytes <span class="token number">526641811</span> <span class="token punctuation">(</span><span class="token number">502.2</span> MiB<span class="token punctuation">)</span></span>
<span class="line">        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>提问：是否不同的网卡所连接的网络必然是不同的网络？如何知道网卡对应的网络？</p></blockquote><p>通过网卡的ip地址和子网掩码，可以计算出该网卡连通的是哪个网段。</p><p>局域网专用网段： 大型局域网：(10.x.x.x) 中型局域网：(172.16.x.x~172.31.x.x) 小型局域网：(192.168.x.x) 内网的机器都用以上范围的IP地址进行通信。 因特网中路由器对目的地址为专用地址的数据报一律不进行转发。</p><h5 id="docker0局域网" tabindex="-1"><a class="header-anchor" href="#docker0局域网"><span>docker0局域网</span></a></h5><p><strong>Docker容器也一样，一台Docker服务器中的容器是属于同一局域网的，由一个称为“docker0”的网桥为不同的容器分配局域网IP，因此可以互相访问。</strong></p><p><strong>网桥：docker0</strong> docker0是一个网桥，维护了一个虚拟网络，它会为容器分配不同的局域网ip。 在linux里，docker0的ip地址一般为172.17.0.1。 其他容器则会分配172.17.0.2，172.17.0.3...如此类推。</p><p><strong>容器与docker0之间的连接：veth-pair</strong> 通过一种称为veth-pair的技术，使容器与docker0之间可以建立连接。</p><p>容器发送报文，都会通过veth-pair技术，与docker0建立连接，然后把报文先发送至docker0； 然后docker0根据自己维护的路由表，找到目的容器的地址，再将报文转发出去。</p><h6 id="docker容器有哪些互相访问的方式" tabindex="-1"><a class="header-anchor" href="#docker容器有哪些互相访问的方式"><span>Docker容器有哪些互相访问的方式？</span></a></h6><p><strong>方式一：虚拟ip访问</strong> 容器启动后，docker0会为容器分配一个IP地址。容器之间可以通过该地址进行互相访问。</p><blockquote><p>必须先运行容器才能知道ip地址，实际用处不大。</p></blockquote><p><strong>方式二：link</strong> 在容器启动时，加上link参数。（--link 容器名:容器别名，使用别名访问容器）</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment">#运行第一个容器</span></span>
<span class="line"><span class="token punctuation">[</span>root@CentOS ~<span class="token punctuation">]</span> <span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span> centos-1 docker.io/centos:latest</span>
<span class="line"><span class="token comment">#运行第二个容器</span></span>
<span class="line"><span class="token punctuation">[</span>root@CentOS ~<span class="token punctuation">]</span> <span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span> centos-2 <span class="token parameter variable">--link</span> centos-1:centos-1 docker.io/centos:latest</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>只能单向访问（centos-2访问centof-1）； 原理类似于在hosts文件中增加一个路由。 多容器、需要互相访问时也不方便。</p></blockquote><p><strong>方式三：创建bridge网络（推荐）</strong></p><ol><li>创建bridge网络：mynet</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> network create mynet</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>将两个容器连接到该网络下</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># --network [哪个网络]</span></span>
<span class="line"><span class="token comment"># --network-alias [容器别名]</span></span>
<span class="line"><span class="token punctuation">[</span>root@CentOS ~<span class="token punctuation">]</span><span class="token comment"># docker run -it --name centos-1 --network testnet --network-alias centos-1 docker.io/centos:latest</span></span>
<span class="line"><span class="token punctuation">[</span>root@CentOS ~<span class="token punctuation">]</span><span class="token comment"># docker run -it --name centos-2 --network testnet --network-alias centos-2 docker.io/centos:latest</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>两个容器中的应用便可以直接通过network-alias中定义的容器别名访问对方</li></ol><h6 id="容器如何访问docker外的网络" tabindex="-1"><a class="header-anchor" href="#容器如何访问docker外的网络"><span>容器如何访问Docker外的网络？</span></a></h6><p>通过iptables的SNAT实现。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment">#查看当前iptable的nat表防火墙策略</span></span>
<span class="line">iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-nL</span></span>
<span class="line"></span>
<span class="line"><span class="token function">docker</span> port nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="bridge模式-网桥模式-docker的默认网络模式" tabindex="-1"><a class="header-anchor" href="#bridge模式-网桥模式-docker的默认网络模式"><span>Bridge模式（网桥模式：Docker的默认网络模式）</span></a></h5><h5 id="docker的其他网络模式" tabindex="-1"><a class="header-anchor" href="#docker的其他网络模式"><span>Docker的其他网络模式</span></a></h5><p>Docker的网络模式有以下几种（默认为bridge模式）：</p><ul><li>host模式（--net=host）</li><li>container模式（--net=container:container_id/container_name）</li><li>none模式（--net=none）</li><li>bridge模式（--net=bridge）</li></ul><p>使用哪种网络模式，可在运行容器（docker run）时指定。</p><p>无论哪种模式，Docker在安装完成后都会创建一个名为docker0的虚拟网桥。</p><p><strong>bridge模式</strong>： bridge模式（桥接模式）是Docker容器的默认网络模式。</p><p>类似于VMware的NAT模式；</p><p>使用到一个叫veth-pair的技术，该技术用于连通不同的虚拟网络设备。</p><blockquote><p>veth-pair就是一对虚拟网卡，容器中一个，宿主机上一个；</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment">#容器中调用ip addr命令</span></span>
<span class="line"><span class="token number">20166</span>: eth0@if20167: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default </span>
<span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span></span>
<span class="line">    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0</span>
<span class="line">       valid_lft forever preferred_lft forever</span>
<span class="line"><span class="token comment">#宿主机中调用ip addr命令</span></span>
<span class="line"><span class="token number">20167</span>: veth35438b4@if20166: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP </span>
<span class="line">    link/ether <span class="token number">16</span>:21:9e:97:49:18 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>host模式</strong> 类似于VMware的桥接模式</p><p><strong>container模式</strong></p><p><strong>none模式</strong> 无网络</p><h4 id="docker镜像的原理" tabindex="-1"><a class="header-anchor" href="#docker镜像的原理"><span>Docker镜像的原理</span></a></h4><p><em><strong>UnionFS（联合文件系统）</strong></em> 是Docker镜像用到的一个分层的文件系统。 当我们在Docker pull拉取镜像时，可以看到Docker会将镜像一层一层的拉取下来。 举例：Mysql的镜像是如何构成的。</p><ul><li>第一层：bootfs（boot file system），用于加载内核到内存（与BIOS同理）</li><li>第二层：rootfs（root file system），包含/dev，/proc，/bin等文件，代表不同的操作系统发行版，如CentOS，Ubuntu等</li></ul><h4 id="docker可视化工具" tabindex="-1"><a class="header-anchor" href="#docker可视化工具"><span>Docker可视化工具</span></a></h4><ul><li>portainer</li><li>Rancher</li></ul><h5 id="portainer" tabindex="-1"><a class="header-anchor" href="#portainer"><span>portainer</span></a></h5><p><em><strong>在Docker中运行portainer</strong></em></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker run -d -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true protainer/protainer</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="docker使用实例" tabindex="-1"><a class="header-anchor" href="#docker使用实例"><span>Docker使用实例</span></a></h2><h4 id="使用docker搭建redis集群" tabindex="-1"><a class="header-anchor" href="#使用docker搭建redis集群"><span>使用Docker搭建Redis集群</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">--name</span> kris-redis <span class="token parameter variable">-p</span> <span class="token number">6380</span>:6379 <span class="token parameter variable">-d</span> redis <span class="token parameter variable">--requirepass</span> <span class="token string">&quot;123456&quot;</span></span>
<span class="line"><span class="token comment">#后台启动redis 守护线程</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> kris-redis redis-cli</span>
<span class="line"><span class="token comment">#客户端无密码登录</span></span>
<span class="line"></span>
<span class="line">auth <span class="token string">&#39;123456&#39;</span></span>
<span class="line"><span class="token comment">#输入登录密码</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">..</span>.</span>
<span class="line"><span class="token comment">#输入redis命令</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用docker搭建mysql服务器-单机" tabindex="-1"><a class="header-anchor" href="#使用docker搭建mysql服务器-单机"><span>使用Docker搭建Mysql服务器（单机）</span></a></h4><p>参考：https://www.cnblogs.com/sablier/p/11605606.html</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"></span>
<span class="line"><span class="token function">docker</span> pull mysql <span class="token comment"># 拉取最新版mysql镜像</span></span>
<span class="line"></span>
<span class="line"><span class="token function">docker</span> images <span class="token comment"># 检查是否拉取成功</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token function">docker</span> run </span>
<span class="line"><span class="token parameter variable">--name</span> mysql </span>
<span class="line"><span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 </span>
<span class="line"><span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> </span>
<span class="line"><span class="token parameter variable">-v</span> /usr/data/mysql/conf:/etc/mysql </span>
<span class="line"><span class="token parameter variable">-v</span> /usr/data/mysql/logs:/var/log/mysql </span>
<span class="line"><span class="token parameter variable">-v</span> /usr/data/mysql/data:/var/lib/mysql </span>
<span class="line"><span class="token parameter variable">-v</span> /usr/data/mysql/my.cnf:/etc/mysql/my.cnf</span>
<span class="line"><span class="token parameter variable">-d</span> mysql</span>
<span class="line"><span class="token comment"># –name：容器名，此处命名为mysql</span></span>
<span class="line"><span class="token comment">#-e：配置信息，此处配置mysql的root用户的登陆密码</span></span>
<span class="line"><span class="token comment">#-p：端口映射，此处映射 主机3306端口 到 容器的3306端口</span></span>
<span class="line"><span class="token comment">#-d：后台运行容器，保证在退出终端后容器继续运行</span></span>
<span class="line"><span class="token comment">#-v：卷挂载</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mysql <span class="token function">bash</span> mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p123456</span> <span class="token comment">#进入docker本地连接mysql客户端</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用docker搭建jenkins服务器" tabindex="-1"><a class="header-anchor" href="#使用docker搭建jenkins服务器"><span>使用Docker搭建Jenkins服务器</span></a></h4><h4 id="使用docker部署springboot服务" tabindex="-1"><a class="header-anchor" href="#使用docker部署springboot服务"><span>使用Docker部署SpringBoot服务</span></a></h4><ol><li><p>制作SpringBoot应用的Jar包 &amp; 准备JDK压缩包</p></li><li><p>制作Dockerfile脚本</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">FROM centos</span>
<span class="line"><span class="token comment">#创建人</span></span>
<span class="line">MAINTAINER dyz</span>
<span class="line"><span class="token comment">#添加项目</span></span>
<span class="line">COPY ./sample-hystrix-server-0.0.1-SNAPSHOT.jar /usr/local/</span>
<span class="line"><span class="token comment">#添加JDK并解压</span></span>
<span class="line">ADD ./jdk-8u301-linux-x64.tar.gz /usr/local/java</span>
<span class="line"><span class="token comment"># 设置环境变量</span></span>
<span class="line">ENV <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/local/java/jdk1.8.0_301</span>
<span class="line">ENV <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar</span>
<span class="line">ENV <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span></span>
<span class="line"><span class="token comment"># 设置工作目录</span></span>
<span class="line">WORKDIR /usr/local/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><p>上传Jar包到服务器</p></li><li><p>构建镜像</p></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> build <span class="token parameter variable">-f</span> ./usr/local/samp1/Dockerfile <span class="token parameter variable">-t</span> <span class="token punctuation">[</span>镜像名称<span class="token punctuation">]</span> <span class="token builtin class-name">.</span> <span class="token comment">#注意后面还有一个英文句号</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="5"><li>新建容器</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token parameter variable">--name</span> sample-hystrix-server sample-hystrix-server /bin/bash</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="6"><li>检查JDK是否安装成功</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">java</span> <span class="token parameter variable">-version</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="7"><li>容器内启动微服务</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">java</span> <span class="token parameter variable">-jar</span> sample-hystrix-server-0.0.1-SNAPSHOT.jar</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="8"><li>退出容器，让微服务在后台运行</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">Ctrl+P+Q</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="使用docker部署rabbitmq服务" tabindex="-1"><a class="header-anchor" href="#使用docker部署rabbitmq服务"><span>使用Docker部署RabbitMQ服务</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> pull rabbitmq <span class="token comment">#拉取最新的rabbitmq镜像</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> rabbitmq <span class="token parameter variable">-p</span> <span class="token number">5672</span>:5672 <span class="token parameter variable">-p</span> <span class="token number">15672</span>:15672 <span class="token parameter variable">-v</span> /data:/var/lib/rabbitmq <span class="token parameter variable">--hostname</span> myRabbit <span class="token parameter variable">-e</span> <span class="token assign-left variable">RABBITMQ_DEFAULT_VHOST</span><span class="token operator">=</span>my_vhost <span class="token parameter variable">-e</span> <span class="token assign-left variable">RABBITMQ_DEFAULT_USER</span><span class="token operator">=</span>admin <span class="token parameter variable">-e</span> <span class="token assign-left variable">RABBITMQ_DEFAULT_PASS</span><span class="token operator">=</span>admin</span>
<span class="line"></span>
<span class="line"><span class="token comment">#-d 后台运行容器；</span></span>
<span class="line"><span class="token comment">#--name 指定容器名；</span></span>
<span class="line"><span class="token comment">#-p 指定服务运行的端口（5672：应用访问端口；15672：控制台Web端口号）；</span></span>
<span class="line"><span class="token comment">#-v 映射目录或文件；</span></span>
<span class="line"><span class="token comment">#--hostname  主机名（RabbitMQ的一个重要注意事项是它根据所谓的 “节点名称” 存储数据，默认为主机名）；</span></span>
<span class="line"><span class="token comment">#-e 指定环境变量；（RABBITMQ_DEFAULT_VHOST：默认虚拟机名；RABBITMQ_DEFAULT_USER：默认的用户名；RABBITMQ_DEFAULT_PASS：默认用户名的密码）</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">http://Server-IP:15672 <span class="token comment">#在浏览器访问RabbitMQ控制台</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用docker部署nacos" tabindex="-1"><a class="header-anchor" href="#使用docker部署nacos"><span>使用Docker部署Nacos</span></a></h4><p>https://www.cnblogs.com/allennote/articles/12459907.html</p><h4 id="使用docker部署kafka" tabindex="-1"><a class="header-anchor" href="#使用docker部署kafka"><span>使用Docker部署kafka</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token comment">#docker-compose.yml</span></span>
<span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;2&#39;</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">zookeeper</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/zookeeper</span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./data<span class="token punctuation">:</span>/data</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;2181:2181&quot;</span></span>
<span class="line">  <span class="token key atrule">kafka</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> wurstmeister/kafka</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;9092&quot;</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment">#KAFKA_ADVERTISED_HOST_NAME: PLAINTEXT://172.0.0.1:9092 </span></span>
<span class="line">      <span class="token key atrule">KAFKA_MESSAGE_MAX_BYTES</span><span class="token punctuation">:</span> <span class="token number">2000000</span></span>
<span class="line">      <span class="token key atrule">KAFKA_ZOOKEEPER_CONNECT</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span><span class="token number">2181</span></span>
<span class="line">      <span class="token key atrule">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//192.168.31.71<span class="token punctuation">:</span><span class="token number">9092</span></span>
<span class="line">      <span class="token key atrule">KAFKA_LISTENERS</span><span class="token punctuation">:</span> PLAINTEXT<span class="token punctuation">:</span>//192.168.31.71<span class="token punctuation">:</span><span class="token number">9092</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./kafka<span class="token punctuation">-</span>logs<span class="token punctuation">:</span>/kafka</span>
<span class="line">      <span class="token punctuation">-</span> /var/run/docker.sock<span class="token punctuation">:</span>/var/run/docker.sock</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> zookeeper</span>
<span class="line">  <span class="token key atrule">kafka-manager</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> sheepkiller/kafka<span class="token punctuation">-</span>manager</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> 9020<span class="token punctuation">:</span><span class="token number">9000</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">ZK_HOSTS</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span><span class="token number">2181</span></span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> kafka</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后执行docker-compose up -d即可</p><h4 id="docker部署zookeeper" tabindex="-1"><a class="header-anchor" href="#docker部署zookeeper"><span>Docker部署Zookeeper</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> pull zookeeper:latest</span>
<span class="line"></span>
<span class="line"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">2181</span>:2181 <span class="token parameter variable">--name</span> zookeeper <span class="token parameter variable">--restart</span> always zookeeper</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="docker部署prometheus" tabindex="-1"><a class="header-anchor" href="#docker部署prometheus"><span>Docker部署prometheus</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> run <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">-p</span> <span class="token number">9090</span>:9090 <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">-v</span> /path/to/prometheus.yml:/etc/prometheus/prometheus.yml <span class="token punctuation">\\</span></span>
<span class="line">    prom/prometheus</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="docker部署rocketmq" tabindex="-1"><a class="header-anchor" href="#docker部署rocketmq"><span>Docker部署RocketMQ</span></a></h4><p>参考：<a href="https://zhuanlan.zhihu.com/p/137477999" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/137477999</a><a href="https://blog.csdn.net/weixin_48182198/article/details/106441206" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/weixin_48182198/article/details/106441206</a></p><p>1.创建以下文件、文件夹</p><ul><li>rocketmq <ul><li>docker-compose.yml</li><li>opt <ul><li>rocketmq <ul><li>conf <ul><li>broker.conf</li></ul></li><li>logs</li><li>store</li></ul></li></ul></li></ul></li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment">#broker.conf内容</span></span>
<span class="line">brokerClusterName <span class="token operator">=</span> DefaultCluster</span>
<span class="line">brokerName <span class="token operator">=</span> broker-a</span>
<span class="line">brokerId <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">deleteWhen <span class="token operator">=</span> 04</span>
<span class="line">fileReservedTime <span class="token operator">=</span> <span class="token number">48</span></span>
<span class="line">brokerRole <span class="token operator">=</span> ASYNC_MASTER</span>
<span class="line">flushDiskType <span class="token operator">=</span> ASYNC_FLUSH</span>
<span class="line"><span class="token comment">#需要配置成宿主机的IP</span></span>
<span class="line">brokerIP1 <span class="token operator">=</span> <span class="token number">192.168</span>.0.101</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token comment">#docker-compose.yml内容</span></span>
<span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> &#39;2&#39;services<span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">namesrv</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> rocketmqinc/rocketmq</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> rmqnamesrv</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> 9876<span class="token punctuation">:</span><span class="token number">9876</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> /opt/rocketmq/logs<span class="token punctuation">:</span>/home/rocketmq/logs</span>
<span class="line">      <span class="token punctuation">-</span> /opt/rocketmq/store<span class="token punctuation">:</span>/home/rocketmq/store</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> sh mqnamesrv</span>
<span class="line">  <span class="token key atrule">broker</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> rocketmqinc/rocketmq</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> rmqbroker</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> 10909<span class="token punctuation">:</span><span class="token number">10909</span></span>
<span class="line">      <span class="token punctuation">-</span> 10911<span class="token punctuation">:</span><span class="token number">10911</span></span>
<span class="line">      <span class="token punctuation">-</span> 10912<span class="token punctuation">:</span><span class="token number">10912</span></span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> /opt/rocketmq/logs<span class="token punctuation">:</span>/home/rocketmq/logs</span>
<span class="line">      <span class="token punctuation">-</span> /opt/rocketmq/store<span class="token punctuation">:</span>/home/rocketmq/store</span>
<span class="line">      <span class="token punctuation">-</span> /opt/rocketmq/conf/broker.conf<span class="token punctuation">:</span>/opt/rocketmq<span class="token punctuation">-</span>4.4.0/conf/broker.conf</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> sh mqbroker <span class="token punctuation">-</span>n namesrv<span class="token punctuation">:</span>9876 <span class="token punctuation">-</span>c ../conf/broker.conf</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> namesrv</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> JAVA_HOME=/usr/lib/jvm/jre</span>
<span class="line">  <span class="token key atrule">console</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> styletang/rocketmq<span class="token punctuation">-</span>console<span class="token punctuation">-</span>ng</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> rocketmq<span class="token punctuation">-</span>console<span class="token punctuation">-</span>ng</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> 8087<span class="token punctuation">:</span><span class="token number">8080</span></span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> namesrv</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> JAVA_OPTS= <span class="token punctuation">-</span>Dlogging.level.root=info   <span class="token punctuation">-</span>Drocketmq.namesrv.addr=rmqnamesrv<span class="token punctuation">:</span><span class="token number">9876</span> </span>
<span class="line">      <span class="token punctuation">-</span> Dcom.rocketmq.sendMessageWithVIPChannel=false</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用docker部署nginx" tabindex="-1"><a class="header-anchor" href="#使用docker部署nginx"><span>使用Docker部署Nginx</span></a></h4><h2 id="docker常见命令" tabindex="-1"><a class="header-anchor" href="#docker常见命令"><span>Docker常见命令</span></a></h2><hr><h4 id="docker应用操作" tabindex="-1"><a class="header-anchor" href="#docker应用操作"><span>Docker应用操作</span></a></h4><p><em><strong>systemctl start docker</strong></em> 启动Docker守护进程</p><p><em><strong>systemctl stop docker</strong></em> 停止Docker守护进程</p><p><em><strong>systemctl restart docker</strong></em> 重启Docker守护进程</p><p><em><strong>docker version</strong></em> 查看docker版本（亦可检查docker是否安装成功）</p><p><em><strong>docker info</strong></em> 查看docker信息（根目录）</p><hr><h4 id="容器操作" tabindex="-1"><a class="header-anchor" href="#容器操作"><span>容器操作</span></a></h4><p><em><strong>docker run -d ubuntu</strong></em> 用ubuntu镜像创建一个容器，后台运行（但因为没有运行任何“前台进程”，因此运行完后输入docker ps会发现，容器又停止了）</p><p><em><strong>docker run -it ubuntu /bin/bash</strong></em> 用ubuntu镜像创建一个容器，并以命令行形式进入该容器</p><p><em><strong>docker run -d -P --name pytest training/webapp python app.py</strong></em> 用webapp镜像创建一个容器，后台运行（-d），随机映射一个端口（-P）,并运行容器上的app.py</p><p><em><strong>run详解</strong></em> 首先是run的语法如下：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span>
<span class="line"></span>
<span class="line">OPTIONS ：有以下可选项（常用，可参考docker run --help）</span>
<span class="line">    --name [containername] #为容器起名</span>
<span class="line">    -v [目录地址] #匿名挂载</span>
<span class="line">    -v [卷名]:[目录地址]  #具名挂载</span>
<span class="line">    -v /[本地目录地址]:[容器内地址]  #指定路径挂载</span>
<span class="line">    -d #后台运行</span>
<span class="line">    -p [本地端口]:[容器端口]</span>
<span class="line"></span>
<span class="line">IMAGE： 指需要启动的镜像名</span>
<span class="line"></span>
<span class="line">COMMAND ：</span>
<span class="line">    空 #运行容器默认的命令</span>
<span class="line">    /bin/bash #以命令行方式进入容器</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>exit/Ctrl+C</strong></em> 退出Docker容器（且容器停止）</p><p><em><strong>Ctrl+P+Q</strong></em> 退出Docker容器（容器继续运行）</p><p><em><strong>docker ps</strong></em> 查看运行中的容器</p><p><em><strong>docker ps -a</strong></em> 查看所有容器</p><p><em><strong>docker stop [CONTAINERID]</strong></em> 停止容器（CONTAINERID可通过docker ps -a查看）</p><p><em><strong>docker start [CONTAINERID]</strong></em> 启动一个已停止的容器（CONTAINERID可通过docker ps -a查看）</p><p><em><strong>docker restart [CONTAINERID]</strong></em> 启动一个已停止的容器（CONTAINERID可通过docker ps -a查看）</p><p><em><strong>docker run -itd --name ubuntu-test ubuntu /bin/bash</strong></em> 用ubuntu镜像创建一个容器； 命名为ubuntu-test； 加了参数d默认不会进入容器</p><p><em><strong>docker attach [CONTAINERID]</strong></em> 打开已运行的终端进入容器</p><p><em><strong>docker exec -it [CONTAINERID] /bin/bash</strong></em> 开启一个新的终端来进入容器</p><p><em><strong>docker inspect [CONTAINERID]</strong></em> 查看容器的详细信息 State：状态（Running、Pause、Restarting...） Image：对应的镜像ID HostConfig.Binds：卷挂载 HostConfig.PortBinding：端口映射 Mounts：卷挂载 Configs.ENV：容器开启后的环境变量 Configs.Cmd：容器开启时运行的命令 Configs.Image：生成容器的镜像名 Configs.WorkingDir：进入容器后的默认地址 NetworkSettings.Ports：端口映射 NetworkSettings.Gateway： NetworkSettings.IPAddress： NetworkSettings.Networks：</p><p><em><strong>docker rm -f [CONTAINERID]</strong></em> 删除容器</p><p><em><strong>docker stop $(docker ps -aq)</strong></em> 删除所有容器</p><p><em><strong>docker rm $(docker ps -aq)</strong></em> 删除所有容器</p><hr><h4 id="镜像操作" tabindex="-1"><a class="header-anchor" href="#镜像操作"><span>镜像操作</span></a></h4><p><em><strong>docker images</strong></em> 列出本机里的镜像列表</p><ul><li>REPOSITORY：表示镜像的仓库源</li><li>TAG：镜像的标签（下面称为“版本”）</li><li>IMAGE ID：镜像ID</li><li>CREATED：创建时间</li><li>SIZE：镜像大小</li></ul><p><em><strong>docker run -it ubuntu:14.04 /bin/bash</strong></em> 使用版本为14.04的ubuntu镜像来创建容器</p><p><em><strong>docker pull [Image Name]</strong></em> 手动从仓库拉取Docker镜像到本地； 如：docker pull ubuntu:14.04 当本地没有该镜像时，docker会自动从仓库拉取这个镜像。仓库地址： https://hub.docker.com/</p><p><em><strong>docker search httpd</strong></em> 查找httpd的Docker镜像</p><p><em><strong>docker rmi hello-world</strong></em> 删除镜像</p><p><em><strong>docker rmi -f $(docker images -qa)</strong></em> 删除所有镜像</p><p><em><strong>docker build -t [镜像标签名] .</strong></em> 使用当前目录下的Dockerfile创建镜像</p><hr><h4 id="仓库操作" tabindex="-1"><a class="header-anchor" href="#仓库操作"><span>仓库操作</span></a></h4><p><em><strong>docker login -u [username] -p [password]</strong></em> 登录到仓库（dockerhub）</p><hr><h4 id="网络操作" tabindex="-1"><a class="header-anchor" href="#网络操作"><span>网络操作</span></a></h4><p><em><strong>docker network ls</strong></em> 查看Docker服务器正在维护的虚拟子网</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span>
<span class="line">33a42a4a7c62   bridge    bridge    local</span>
<span class="line">3857b46c9a21   host      host      local</span>
<span class="line">69024ef4e0be   none      null      local</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>docker network inspect [network-id]</strong></em> 查看网络的详细信息（比如哪些容器在用该网络、这些容器的ip、mac地址等）</p><p><em><strong>docker network create [network-name]</strong></em> 创建虚拟子网</p><p><em><strong>docker network connect [network-name] [container-name]</strong></em> 将容器（原来在虚拟子网A）连接到虚拟子网B上</p><hr><h4 id="多容器操作-compose" tabindex="-1"><a class="header-anchor" href="#多容器操作-compose"><span>多容器操作（Compose）</span></a></h4><p><strong>注意！以下命令均需要到docker-compose.yml目录下执行</strong></p><p><em><strong>docker-compose up</strong></em> 运行所有服务容器</p><p><em><strong>docker-compose ps</strong></em> 列出Compose项目中所有的容器</p><p><em><strong>docker-compose stop</strong></em> 停止Compose项目中所有的容器</p><p><em><strong>docker-compose down</strong></em> 停用并移除所有容器以及网络相关</p><p><em><strong>docker-compose logs -f</strong></em> 查看Compose项目启动日志</p><p><em><strong>docker-compose run [SERVICE] [COMMAND]</strong></em> 在Compose项目的某个服务中跑一条SHELL命令</p><p><em><strong>docker-compose config</strong></em> 查看docker-compose.yml内容</p><h5 id="docker-compose-yml语法" tabindex="-1"><a class="header-anchor" href="#docker-compose-yml语法"><span>docker-compose.yml语法</span></a></h5><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3.7&quot;</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token comment">#核心部分，每个service对应一个Dockerfile</span></span>
<span class="line">  <span class="token key atrule">web</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> <span class="token string">&quot;web1&quot;</span> <span class="token comment">#容器名</span></span>
<span class="line">    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> <span class="token string">&quot;web&quot;</span> <span class="token comment">#主机名</span></span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always <span class="token comment">#跟随docker重启</span></span>
<span class="line">    <span class="token key atrule">build</span><span class="token punctuation">:</span> . <span class="token comment">#指定该服务的Dockerfile所在位置，默认为当前目录</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> centos<span class="token punctuation">:</span>latest <span class="token comment">#指定使用哪个镜像构建容器，version1中image和build不能共存；version2之后则可以（为镜像打上image指定的标签）</span></span>
<span class="line">    <span class="token key atrule">links</span><span class="token punctuation">:</span> <span class="token comment">#如何访问其他服务（等于在容器的/etc/hosts文件中创建相应记录）</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;mysql&quot;</span>  <span class="token comment">#通过“mysql”就可以访问到mysql所在容器（例如ping mysql）</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;mysql:myMysql&quot;</span> <span class="token comment">#服务名：自定义名称。在容器中通过myMysql访问mysql所在容器（例如ping myMysql）</span></span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span> <span class="token comment">#按依赖顺序启动服务（即先启动mysql，再启动web）</span></span>
<span class="line">      <span class="token punctuation">-</span> mysql</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;8080&quot;</span> <span class="token comment">#仅写容器端口，这样会随机映射宿主机的端口</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;8080:8080&quot;</span> <span class="token comment">#宿主机端口:容器端口</span></span>
<span class="line">    <span class="token key atrule">expose</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;8080&quot;</span> <span class="token comment">#暴露端口，但不映射到宿主机（供其他容器使用）</span></span>
<span class="line">    <span class="token comment">#command: 默认的容器启动命令</span></span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span> </span>
<span class="line">      <span class="token punctuation">-</span> dev </span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> /opt/data/mysql<span class="token punctuation">:</span>/var/lib/mysql <span class="token comment">#容器内绝对路径:宿主机的绝对路径</span></span>
<span class="line">      <span class="token punctuation">-</span> ./opt/data/mysql<span class="token punctuation">:</span>/var/lib/mysql <span class="token comment">#</span></span>
<span class="line">      <span class="token punctuation">-</span> myvolume<span class="token punctuation">:</span>/var/lib/mysql <span class="token comment">#已定义的数据卷:宿主机的绝对路径</span></span>
<span class="line">      <span class="token punctuation">-</span> ./</span>
<span class="line">  <span class="token key atrule">mysql</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./mysql <span class="token comment">#指定该服务的Dockerfile所在位置</span></span>
<span class="line">    <span class="token key atrule">env_file</span><span class="token punctuation">:</span> ./mysql/.env <span class="token comment">#从文件添加环境变量</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span>  <span class="token comment">#添加环境变量</span></span>
<span class="line">      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token string">&#39;123456&#39;</span></span>
<span class="line">      <span class="token key atrule">IS_TRUE</span><span class="token punctuation">:</span> <span class="token string">&#39;true&#39;</span></span>
<span class="line">    <span class="token key atrule">networks</span><span class="token punctuation">:</span> <span class="token comment">#添加以下配置以后，web容器就可以通过mysql:3306（服务名）或者mysqlaliaes:3306（aliaes）访问mysql了（因为都同属于dev网络）</span></span>
<span class="line">      <span class="token key atrule">dev</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">aliaes</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token punctuation">-</span> mysqlaliaes</span>
<span class="line"><span class="token key atrule">networks</span><span class="token punctuation">:</span> <span class="token comment">#docker-compose up之后，会创建一个默认网络&quot;appname_default&quot;；以下部分则是让开发者可以按需添加网络</span></span>
<span class="line">  <span class="token key atrule">dev</span><span class="token punctuation">:</span> </span>
<span class="line">    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge <span class="token comment">#默认桥接模式，可不填</span></span>
<span class="line">  <span class="token key atrule">pro</span><span class="token punctuation">:</span> </span>
<span class="line">  <span class="token key atrule">app</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#是否预先创建好的网络</span></span>
<span class="line"><span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span> <span class="token comment">#等于在hosts文件中加上ip和域名映射</span></span>
<span class="line">  162.242.195.82  somehost</span>
<span class="line">  50.31.209.229   otherhost</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="集群操作-swarm" tabindex="-1"><a class="header-anchor" href="#集群操作-swarm"><span>集群操作（Swarm）</span></a></h4><p><em><strong>docker swarm init --advertise-addr [IP]</strong></em> 初始化一个Docker的服务集群，并赋予它一个IP地址（一般是本机的IP地址）。</p><p><em><strong>docker swarm join-token manage / docker swarm join-token worker</strong></em> 获取一个令牌（若需要将其他机器加入到集群，需要先获取令牌）</p><p><em><strong>docker swarm join [JOIN-TOKEN] [IP:PORT]</strong></em> 将本机加入到一个Docker集群中，该Docker集群的地址为IP：PORT</p><p><em><strong>docker node ls</strong></em> 查看集群里有多少节点，及节点的详细信息（主机名、是管理节点还是工作节点等） 该命令只能在管理节点里可用 <em><strong>docker swarm leave</strong></em> 本机退出当前集群</p><hr><h4 id="服务操作" tabindex="-1"><a class="header-anchor" href="#服务操作"><span>服务操作</span></a></h4><p><em><strong>docker service create -p 80:8080 --name my-nginx nginx</strong></em></p><p><em><strong>docker service ls</strong></em></p><p><em><strong>docker service ps [SERVICE_NAME]</strong></em></p><p><em><strong>docker service update --replicas 3 my-nginx</strong></em> 创建3个服务的副本 <em><strong>docker service scale my-nginx=5</strong></em> 创建5个服务的副本 <em><strong>docker service rm my-nginx</strong></em> 移除服务</p><hr><h4 id="其他操作" tabindex="-1"><a class="header-anchor" href="#其他操作"><span>其他操作</span></a></h4><p><em><strong>docker --help</strong></em> 查看docker帮助文档</p><p><em><strong>docker run --help</strong></em> 查看run命令的帮助文档（其他命令同理）</p><p><em><strong>docker cp [CONTAINERID]:路径 本机路径</strong></em> 将容器内的文件拷贝到本机</p><p><em><strong>docker volumn ls</strong></em> 查看所有容器的卷挂载情况</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">DRIVER    VOLUME NAME</span>
<span class="line">local     0d50d9bf15664fd57e7568d9e68f6d7a89a7dcc4ebcc1ac816b0ac0859a429db</span>
<span class="line">local     firstvolume</span>
<span class="line"></span>
<span class="line">#第一个是匿名卷，第二个是具名卷；</span>
<span class="line">#前两个卷都维护在/var/lib/docker/volumes/ 里；</span>
<span class="line">#若这两个卷里有文件的增减，则对应容器内对应的地址也会与卷内的情况同步</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>docker volume inspect [VOLUME NAME]</strong></em> 查看某个卷的信息</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">[</span>
<span class="line">    {</span>
<span class="line">        &quot;CreatedAt&quot;: &quot;2021-08-31T23:58:58+08:00&quot;,</span>
<span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span>
<span class="line">        &quot;Labels&quot;: null,</span>
<span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/firstvolume/_data&quot;,</span>
<span class="line">        &quot;Name&quot;: &quot;firstvolume&quot;,</span>
<span class="line">        &quot;Options&quot;: null,</span>
<span class="line">        &quot;Scope&quot;: &quot;local&quot;</span>
<span class="line">    }</span>
<span class="line">]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em><strong>docker logs [CONTAINER NAME] -f</strong></em> 查看容器日志 -f：跟踪日志 --tail=10：仅显示最新10条日志</p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><p>Docker官方文档 <a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/</a></p><p>官方Dockerfile、docker-entrypoint.sh： <a href="https://github.com/docker-library" target="_blank" rel="noopener noreferrer">https://github.com/docker-library</a></p><p>遇见狂神说：Docker入门系列视频</p><p>遇见狂神说：Docker进阶系列视频<a href="https://www.bilibili.com/video/BV1kv411q7Qc" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1kv411q7Qc</a></p><p>中文文档：<a href="https://vuepress.mirror.docker-practice.com/" target="_blank" rel="noopener noreferrer">https://vuepress.mirror.docker-practice.com/</a></p>`,244)]))}const o=n(p,[["render",i]]),r=JSON.parse('{"path":"/devops/docker/Docker%E7%AC%94%E8%AE%B0.html","title":"Docker","lang":"en-US","frontmatter":{"title":"Docker","sidebar":"heading"},"git":{"updatedTime":1750240340000,"contributors":[{"name":"dongyz8","username":"dongyz8","email":"dongyz8@gdii-yueyun.com","commits":3,"url":"https://github.com/dongyz8"}],"changelog":[{"hash":"ad8fc1a188d6829c38676e985c8e2097211af10d","time":1750240340000,"email":"dongyz8@gdii-yueyun.com","author":"dongyz8","message":"commit"},{"hash":"2107fe45a32694cb96e49385ca5e0106c7ec14a9","time":1732669486000,"email":"dongyz8@gdii-yueyun.com","author":"dongyz8","message":"commit"},{"hash":"fb7cc624832f782b737cd66a5463ce109935379b","time":1709287696000,"email":"dongyz8@gdii-yueyun.com","author":"dongyz8","message":"commit"}]},"filePathRelative":"devops/docker/Docker笔记.md"}');export{o as comp,r as data};
